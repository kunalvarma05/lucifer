os: linux
language: node_js

cache:
  directories:
    - ~/.npm

notifications:
  email: false

branches:
  except:
    - /^v\d+\.\d+\.\d+$/

jobs:
  include:
    - &test8
      stage: test
      node_js: 8
      script:
        - npm run test:prod
    - &test10
      stage: test
      node_js: 10
      script:
        - npm run test:prod
    - &test11
      stage: test
      node_js: 11
      script:
        - npm run test:prod
    - &test12
      stage: test
      node_js: 12
      script:
        - npm run test:prod
      after_success:
        - npm run travis-deploy-once "npm run report-coverage"

    - &build8
      stage: build
      node_js: 8
      script:
        - npm run build
    - &build10
      stage: build
      node_js: 10
      script:
        - npm run build
    - &build11
      stage: build
      node_js: 11
      script:
        - npm run build
    - &build12
      stage: build
      node_js: 12
      script:
        - npm run build
      cache:
        directories:
          - ~/dist

    - &deploy
      stage: deploy
      node_js: 12
      branches:
        only:
          - master
      script:
        - if [ "$TRAVIS_BRANCH" = "master" -a "$TRAVIS_PULL_REQUEST" = "false" ]; then npm run travis-deploy-once "npm run semantic-release"; fi
      deploy:
        local_dir: docs
        target_branch: gh-pages
        provider: pages
        cleanup: false
        keep_history: true
        committer_from_gh: true
        token: $GH_TOKEN # Set in the settings page of your repository, as a secure variable
        on:
          branch: master
